---
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import { getPostUrlBySlug } from "@domain/url";
import { formatDateToYYYYMMDD } from "@domain/date";
import type { SeriesItem } from "@features/content";

interface Props {
	seriesList: SeriesItem[];
    lang?: string;
}

const { seriesList, lang } = Astro.props;

const toAnchor = (value: string) =>
	value
		.toLowerCase()
		.trim()
		.replace(/[^a-z0-9]+/g, "-")
		.replace(/^-+|-+$/g, "");
---

<div class="card-base px-8 py-6">
	{seriesList.length === 0 && (
		<div class="text-50">No series yet.</div>
	)}

	{seriesList.map((series) => (
		<div id={`series-${toAnchor(series.name)}`} class="mb-8 last:mb-0 scroll-mt-24">
			<div class="flex items-center justify-between gap-3 mb-3">
				<div class="font-bold text-xl text-90 break-words">
					{series.name}
				</div>
				<div class="text-sm text-50 shrink-0">
					{series.count} {i18n(I18nKey.postsCount, lang)}
				</div>
			</div>

			{series.posts.map((post) => (
				<a
					href={getPostUrlBySlug(post.slug, lang)}
					aria-label={post.data.title}
					class="group btn-plain !block h-10 w-full rounded-lg hover:text-[initial]"
				>
					<div class="flex flex-row justify-start items-center h-full">
						<div class="w-[15%] md:w-[10%] transition text-sm text-right text-50">
							{formatDateToYYYYMMDD(post.data.published)}
						</div>

						<div class="w-[15%] md:w-[10%] relative dash-line h-full flex items-center">
							<div
								class="transition-all mx-auto w-1 h-1 rounded group-hover:h-5 bg-[oklch(0.5_0.05_var(--hue))] group-hover:bg-[var(--primary)] outline outline-4 z-50 outline-[var(--card-bg)] group-hover:outline-[var(--btn-plain-bg-hover)] group-active:outline-[var(--btn-plain-bg-active)]"
							></div>
						</div>

						<div
							class="w-[70%] md:max-w-[65%] md:w-[65%] text-left font-bold group-hover:translate-x-1 transition-all group-hover:text-[var(--primary)] text-75 pr-8 whitespace-nowrap overflow-ellipsis overflow-hidden"
						>
							{post.data.title}
						</div>
					</div>
				</a>
			))}
		</div>
	))}
</div>
