---
import { getEntry } from "astro:content";
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";
import MainGridLayout from "../../layouts/MainGridLayout.astro";
import Markdown from "../../components/misc/Markdown.astro";
import { SUPPORTED_LANGUAGES, DEFAULT_LANGUAGE } from "../../constants/constants";

export async function getStaticPaths() {
    return SUPPORTED_LANGUAGES
        .filter(lang => lang !== DEFAULT_LANGUAGE)
        .map(lang => ({
            params: { lang },
            props: { lang }
        }));
}

const { lang } = Astro.props;

// Explicitly look for the localized file first
let aboutPost;
try {
    // Astro content collections use the filename as the slug/id
    // So we look for 'about.es', 'about.tr', etc.
    aboutPost = await getEntry("spec", `about.${lang}`);
    if (!aboutPost) {
        // If the localized version doesn't exist, try with .md extension
        aboutPost = await getEntry("spec", `about.${lang}.md`);
    }
} catch (e) {
    console.error(`Failed to load about.${lang}:`, e);
}

// Fallback to default 'about' if localized entry is not found
if (!aboutPost) {
    aboutPost = await getEntry("spec", "about");
}

const { Content } = aboutPost ? await aboutPost.render() : { Content: null };
---

<MainGridLayout title={i18n(I18nKey.about, lang)} lang={lang}>
    <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
        <div class="card-base z-10 px-9 py-6 relative w-full ">
            <div class="text-75">
                {Content && (
                    <Markdown class="mt-4">
                        <Content />
                    </Markdown>
                )}
            </div>
        </div>
    </div>
</MainGridLayout>
